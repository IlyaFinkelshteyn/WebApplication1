version: 1.0.{build}
image: Visual Studio 2015
environment:
  AWSAccessKeyId: AKIAINJHMYLFXULA3HKA
  AWSSecretKey:
    secure: yc31WRArURVdTDtBn9PRG4GJ0wHvc9OgeFdOIfm6EMjLnLbILsbk3Dvap8gZrKND
before_build:
- ps: nuget restore
build:
  publish_wap_xcopy: true
  verbosity: minimal
after_build:
- msbuild "C:\projects\webapplication2\WebApplication1.sln" /verbosity:minimal /logger:"C:\Program Files\AppVeyor\BuildAgent\Appveyor.MSBuildLogger.dll" /p:DeployOnBuild=True /p:PublishProfile=appveyor /p:DeployIisAppPath="Default Web Site"

deploy_script:
- ps: $artifacts.values | foreach-object {$_.path}
- ps: $packageweb = $artifacts.values | Where-Object { $_.path -like '*WebApplication1.zip' }
- ps: $exe = "C:\Program Files (x86)\AWS Tools\Deployment Tool\awsdeploy.exe"
- ps: '&$exe -r "-DDeploymentPackage=$($packageweb.path)" "-DEnvironment.Name=Myappweb123-env-1" "-DApplication.Name=MyAppWeb123" "-DRegion=eu-west-1" "-DAWSAccessKey=$env:AWSAccessKeyId" "-DAWSSecretKey=$env:AWSSecretKey" "C:\projects\WebApplication2\awsdeploy.txt"'
